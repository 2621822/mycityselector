My City Selector Joomla Extension
=================================

|       Joomla | 2.5 - 3.x       |
|--------------|-----------------|
| Package      | module & plugin |
| Version      | 1.2.8 beta      |

## Общие сведения

My City Selector - это расширение для CMS Joomla, позволяющее администратору сайта отображать разную информацию для разных городов (список которых он может определить в настройках).

<img src="https://raw.githubusercontent.com/adamasantares/mycityselector/doc128/doc_images/intor.png" alt="" width="100%" />

Изначально, когда расширение создавалось, приследовалась цель сделать возможным изменение части контента страницы при переключении города. То есть домен (хост) при этом не менялся. В виду чего возникла проблема с индексированием контента, ведь поисковики не знали о разном контенте. Для них это были одни и те же страницы. Поэтому в последствии была добавлена возможность разделить города на адресном уровне. Сначала была попытка разделения на подуровни вида "/moscow/page/subpage" или "/spb/page/subpage". В принципе решение сносное, но были некоторые сложности. Далее было решено, что оптимальный вариант - это наличие для каждого города своего поддомена (точнее по факту, сайт существует в единственном числе и все субдомены ссылаются на основной домен). Такое разделение оказалось оптимальным и рекомендуется к применению (можно использовать и предыдущие спобобы, если вам их вполне достаточно). Так или иначе, в настройках задается город по умолчанию, так что в любом случае с индексацией не должно возникнуть больших проблем.

В добавок хочется отметить, что расширение совместимо с модулем мультиязычности. Но при совместном использовании, может понадобиться создать для каждого языка свою копию модуля mod_mycityselector. На данный момент, есть только один серьезный недостаток - это невозможность сопоставить между собой один и тот же город с разными названиями. Поэтому при переключении языка, скорее всего потребуется повторно выбрать город.
Как вариант, можно использовать один модуль для всех языков, но дублировать список городов для каждого языка по группам (возможность группировки городов в списке).
Данный недочет обязательно будет исправлен в следующей версии.

*Примечание: все изображения приводимые здесь основаны на версии Joomla 3.3.6*

## Установка

На данный момент установка возможна только по ссылке или из архива [v1.2.8-beta.2](https://github.com/adamasantares/mycityselector/releases/tag/v1.2.8-beta.2).

В ближайшем будущем планируется разместить на [JED](http://extensions.joomla.org/).

## Настройка

Расширение состоит из плагина и модуля. При корректной установке плагин должен активироваться автоматически. Так что сразу переходим к настройкам модуля.

<img src="https://raw.githubusercontent.com/adamasantares/mycityselector/doc128/doc_images/mod_base_settings.png" alt="" width="100%" />

<img src="https://raw.githubusercontent.com/adamasantares/mycityselector/doc128/doc_images/mod_advanced_settings.png" alt="" width="100%" />

Важные параметры модуля находятся не только на основной вкладке настроек, но и на вкладке дополнительных параметров. Рассмотрим все параметры по порядку.

### Основной домен

Необходим для корректного формирования адресов на поддомены.
Автоматическое определение основного домена (в случае, когда вы уже на поддомене) работает только при условии, что у сайта домен второго уровня (site.ru). Если же сайт находится на одном из многочисленных доменов третьего уровня (site.com.ru), то возникает проблема. Вообще, этот параметр устанавливается автоматически при инсталляции расширения (в качестве значения берется имя текущего хоста).

### Выбор города при входе

Если данный параметр включен, то при первом входе пользователя на сайт, модуль стразу предложит ему выбрать из списка город (отобразит диалог выбора города).
*Примечание: если параметр включен, то не будет работать yandex-geolocation, так как происходит конфликт между автоматическим определением города и выбором пользователя.*

### Геолокация

Функция автоматического определения города. Пытается определить город пользователя и если такой город есть в спике (настройках), то происходит автоматическое переключение контента или редирект на субдомен.
Доступны следующие варианты:

 * SypexGeo - определение города по IP с помощью соответствующего сервиса
 * Yandex Geo - определение города посредством связки механизма геолокации браузера и определения города по координатам через сервис Yandex geocode-maps
 * связка SypexGeo + YandexGeo, когда первый используется как более быстрого определения, а второй, вроде контрольного выстрела

По умолчанию данный функционал отключен.

### Список городов

нууу.... завтра допишу, ночь на дворе :|


## Кастомизация

...
